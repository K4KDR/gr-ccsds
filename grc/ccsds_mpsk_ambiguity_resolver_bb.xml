<?xml version="1.0"?>
<block>
  <name>M-PSK Ambiguity Resolver (CCSDS)</name>
  <key>ccsds_mpsk_ambiguity_resolver_bb</key>
  <category>CCSDS/Receiver/Synchronization</category>
  <import>import ccsds</import>
  <make>ccsds.mpsk_ambiguity_resolver_bb($M,$ASM,$threshold,$ber_threshold,$frame_len)</make>
	<param>
		<name>M</name>
		<key>M</key>
		<value>8</value>
		<type>int</type>
	</param>
	<param>
		<name>Sync Marker (hex)</name>
		<key>ASM</key>
		<value>'1ACFFC1D'</value>
		<type>string</type>
	</param>
	<param>
		<name>Lock threshold</name>
		<key>threshold</key>
		<value>1</value>
		<type>int</type>
	</param>
	<param>
		<name>BER threshold</name>
		<key>ber_threshold</key>
		<value>0</value>
		<type>int</type>
	</param>
	<param>
		<name>Frame data length</name>
		<key>frame_len</key>
		<type>int</type>
	</param>
	<check>$M >= 2</check>
	<check>len($ASM)%2 == 0</check>
	<check>$threshold > 0</check>
	<check>$frame_len > 0</check>
	<sink>
		<name>in</name>
		<type>byte</type>
	</sink>
	<source>
		<name>out</name>
		<type>byte</type>	
	</source>
	<doc>
M-PSK ambiguity resolver.

Take M parallel (ambiguity) streams and look for the attatched sync marker (ASM)
in each stream. Once the ASM is found, lock on the stream containing the ASM and
look for the following ASMs. If in fully locked state a threshold number of ASM
are missing, the block enters search mode again.

M: Number of modulation symbols.

Sync Marker: Hexadecimal representation of the ASM. Must be of odd length as the
ASM must be an integer number of bytes.

Lock threshold: Everytime an ASM is found a counter is increased up to this
threshold value. Everytime a ASM is expected, but did not match the counter is
decreased. As long as the counter is larger than zero the block is in locked
state, returning the bytes of the locked stream as output. If the counter
reaches zero the block enters search mode again and stops it's output until it
is locked again. Setting threshold to one will make the block loose lock
immediatley if an exprected ASM does not match.

BER threshold: Number of biterrors between ASM and received sequence that may
occur to still consider the sequence to match. If set to zero the sequence must
be an exact match of the ASM.

Frame data length: Length of the frame data (excluding the ASM) in bytes. Every
frame data length after an ASM another ASM is expected.
	</doc>
</block>
